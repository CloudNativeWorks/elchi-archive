<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elchi Archive - Envoy, Coraza WASM & Elchi Client</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 40px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e1e4e8;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 500;
            color: #656d76;
            transition: all 0.2s;
        }

        .tab:hover {
            color: #0969da;
        }

        .tab.active {
            color: #0969da;
            border-bottom: 2px solid #0969da;
            margin-bottom: -2px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .release {
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            margin: 20px 0;
            padding: 20px;
        }

        .version {
            font-size: 24px;
            font-weight: 600;
            color: #0969da;
            margin-bottom: 10px;
        }

        .binary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f6f8fa;
        }

        .binary:last-child {
            border-bottom: none;
        }

        .arch {
            font-weight: 500;
        }

        .download {
            background: #238636;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            text-decoration: none;
        }

        .hash {
            font-family: monospace;
            font-size: 12px;
            color: #656d76;
            margin-top: 5px;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .date {
            color: #656d76;
            font-size: 14px;
            margin-bottom: 15px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Elchi Archive</h1>
        <p>Pre-compiled binaries for Envoy, Coraza WASM, and Elchi Client</p>

        <!-- Quick Install Section -->
        <div id="install-section"
            style="background: #f6f8fa; border: 1px solid #d0d7de; border-radius: 6px; padding: 16px; margin-bottom: 20px;">
            <h3 style="margin-top: 0; color: #0969da;">üöÄ Quick Install Elchi Stack</h3>
            <p style="margin-bottom: 12px;">One-command installation for Ubuntu 24.04:</p>
            <div id="install-command"
                style="background: #24292f; color: #e6edf3; padding: 12px; border-radius: 6px; font-family: monospace; font-size: 14px; overflow-x: auto;">
                Loading latest install script...
            </div>
            <p style="margin-top: 12px; font-size: 14px; color: #656d76;">
                Example: <code id="install-example"
                    style="background: #f6f8fa; padding: 2px 6px; border-radius: 3px;">Loading...</code>
            </p>
            <div id="install-download" style="margin-top: 8px;">
                <span style="color: #656d76;">Loading download link...</span>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('envoy', event)">Envoy</button>
            <button class="tab" onclick="switchTab('coroza', event)">Coraza WASM</button>
            <button class="tab" onclick="switchTab('elchi', event)">Elchi Client</button>
        </div>

        <div id="envoy-content" class="tab-content active">
            <h2>Envoy</h2>
            <p>Pre-compiled Envoy binaries for Linux AMD64 and ARM64 architectures.</p>
            <div id="envoy-releases" class="loading">Loading Envoy releases...</div>
        </div>

        <div id="coroza-content" class="tab-content">
            <h2>Coraza Proxy WASM</h2>
            <p>Compiled WASM modules for Coraza Web Application Firewall.</p>
            <div id="coroza-releases" class="loading">Loading Coroza WASM releases...</div>
        </div>

        <div id="elchi-content" class="tab-content">
            <h2>Elchi Client</h2>
            <p>Pre-built Elchi Client binaries and installation scripts.</p>
            <div id="elchi-releases" class="loading">Loading Elchi Client releases...</div>
        </div>
    </div>

    <script>
        function switchTab(tab, event) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            if (event && event.target) {
                event.target.classList.add('active');
            }

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(tab + '-content').classList.add('active');
        }

        function renderReleases(releases, containerId, type) {
            const container = document.getElementById(containerId);

            if (!releases || releases.length === 0) {
                container.innerHTML = '<p>No releases available yet.</p>';
                return;
            }

            container.innerHTML = releases.map(release => `
                <div class="release">
                    <div class="version">${release.version}</div>
                    <div class="date">Released: ${new Date(release.date).toLocaleDateString()}</div>
                    ${(release.binaries || release.files || []).map(item => `
                        <div class="binary">
                            <div>
                                <div class="arch">${item.arch || item.name}</div>
                                <div class="hash">SHA256: ${item.sha256}</div>
                            </div>
                            <a href="${item.download_url}" class="download">Download</a>
                        </div>
                    `).join('')}
                </div>
            `).join('');
        }

        // Update install section with latest release
        function updateInstallSection(installScriptReleases) {
            if (!installScriptReleases || installScriptReleases.length === 0) {
                document.getElementById('install-command').textContent = 'No install script available yet.';
                document.getElementById('install-example').textContent = 'Not available';
                document.getElementById('install-download').innerHTML = '<span style="color: #656d76;">Not available</span>';
                return;
            }

            const latest = installScriptReleases[0];
            const installFile = latest.files.find(f => f.name === 'install.sh');
            const uninstallFile = latest.files.find(f => f.name === 'uninstall.sh');

            if (!installFile) {
                document.getElementById('install-command').textContent = 'Install script not found.';
                return;
            }

            document.getElementById('install-command').textContent =
                `curl -fsSL ${installFile.download_url} | bash -s -- <mainAddress> <port>`;

            document.getElementById('install-example').textContent =
                `curl -fsSL ${installFile.download_url} | bash -s -- elchi.example.com 8080`;

            let downloadHtml = `
                <a href="${installFile.download_url}" download style="display: inline-block; background: #238636; color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; margin-right: 8px;">
                    üì• Download install.sh ${latest.version}
                </a>`;

            if (uninstallFile) {
                downloadHtml += `
                <a href="${uninstallFile.download_url}" download style="display: inline-block; background: #d73a49; color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; margin-right: 8px;">
                    üóëÔ∏è Download uninstall.sh
                </a>`;
            }

            downloadHtml += `
                <span style="margin-left: 4px; font-size: 12px; color: #656d76;">
                    SHA256: ${installFile.sha256.substring(0, 16)}...
                </span>`;

            document.getElementById('install-download').innerHTML = downloadHtml;
        }

        // Load data
        fetch('index.json')
            .then(response => response.json())
            .then(data => {
                renderReleases(data.releases, 'envoy-releases', 'envoy');
                renderReleases(data.coroza_releases, 'coroza-releases', 'coroza');
                renderReleases(data.elchi_client_releases, 'elchi-releases', 'elchi');
                updateInstallSection(data.install_script_releases);
            })
            .catch(error => {
                document.getElementById('envoy-releases').innerHTML = '<p>Error loading releases.</p>';
                document.getElementById('coroza-releases').innerHTML = '<p>Error loading releases.</p>';
                document.getElementById('elchi-releases').innerHTML = '<p>Error loading releases.</p>';
                document.getElementById('install-command').textContent = 'Error loading install script.';
                document.getElementById('install-example').textContent = 'Error';
                document.getElementById('install-download').innerHTML = '<span style="color: #656d76;">Error loading</span>';
                console.error('Error:', error);
            });
    </script>
</body>

</html>